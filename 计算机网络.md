## 互联网的组成

### 边缘部分

+ 客户-服务器方式（C/S方式)

  主要是由客户端和服务端组成，他们之间的通信指的是两个进程之间的通信。他们的关系是服务被服务的关系，客户端主动发送请求，服务端被动接受请求，客户端与服务端建立通信之后，他们之间的通信是相互的，客户端与服务端之间可以互相发送或者接受请求。

+ 对等方式(P2P方式)

  对等方式指的是两台计算机系统进行平等的交流，他们之间没有客户端与服务端的区别，可以互相读取对方硬盘上的数据，其本质还是一个客户-服务器方式的通信。

### 核心部分

核心部分由大量的主机实现连通性，起特殊作用的是路由器，路由器是实现分组构建的关键部件。其任务是接收到转发的分组。

+ 电路交换

  电路交换的特点是占用通信资源->一直占用通信资源->归还通信资源，这种交换方式效率很低，实现任何两台计算机之间的通信成本太大。

+ 分组交换

  分组交换是采用存储转发的一种放方式，我们将要传输的整体数据叫做报文，然后，我们将报文分为许多个部分，叫做分组，在每个分组加上一些控制信息(首部）进行数据的传输，最终将接收到的分组拼接而原始数据。互联网的核心是由许多路由器组成的，主机是用来处理数据，而路由器是传输数据，进行分组的转发。即进行分组交换的。路由器的使用实现了互联网的高速地通信。如果将单个互联网简化为一个链路，那么路由器就是这个链路的结点。这种传输方式如果在数据中出现传输障碍的话，更具协议会选择最适合的路径，保证了传输的高效。分组在哪个部分进行传输，那么这个就占用那个信道的资源。但是由于分组需要进行排队等待传输，所以会造成一定的时延。

+ 报文交换

  报文交换类似于分组交换，但是不如分组交换那样速度快。将报文先传送到相邻的结点，然后进行存储查找转发表，转发到下一个结点
  
+ | 数据交换方式 | 优缺点                                                       |
  | ------------ | ------------------------------------------------------------ |
  | 电路交换     | 端对端的通信因为约定了通信质量而使得通信质量得到了保障，对于传输大量数据效率高。 |
  | 报文交换     | 无需预约传输带宽，动态逐段利用传输带宽，对于突发式的数据通信效率高。 |
  | 分组交换     | 报文交换高效，迅速。同时分组小，灵活。网络生存性能好。       |

### 计算机网络的性能指标

+ 往返时延RTT：从发送方发送数据开始，到发送方收到接收方的确认总共经历的时延，RTT包括往返传播时延和未端处理时延。
+ 利用率，指信道利用率
+ 速率
+ 带宽
+ 吞吐量
+ 时延
+ 时延带宽积

### 计算机网络的组成

+ 硬件，软件和协议
+ 工作方式
  + 边缘部分 用户直接使用
  + 核心部分，为边缘部分服务
+ 功能组成
  + 通信子网 实现数据通信
  + 资源子网 实现资源共享/数据处理

+ 带宽
  + 原本指某一个信号具有的频带宽度，即最高频率与最低频率之差

### 分层结构

#### 7层OSI参考模型

+ 物理层，数据链路层，网络层，传输层，会话层，表示层，应用层。
+ 应用层：与用户交互产生网络流量。
+ 表示层：在两个通信系统中交换信息的表示方式（数据格式交换，数据加密和解密，数据的压缩和解压缩）。
+ 会话层：向表示层提供建立连接并在连接上有序地传输数据，建立，管理，终止会话，在通信失效的时候从检验点继续回复通信数据的同步，适用于传输大文件。
+ 传输层，负责主机中两个进程的通信，是端到端通信，传输单位是报文段或者用户数据报。
+ 网络层：可靠传输，不可靠传输，差错控制和流量控制和复用分用。路由选择，流量控制，拥塞控制。
+ 数据链路层：把网络层上面传下来的数据报封装成帧。数据链路层的传输单位是帧。
+ 物理层：在物理媒体上面实现比特流的透明传输。

#### TCP/IP参考模型

+ 应用层，传输层，网际层，网络接口层。

#### 5层参考模型

+ 应用层，传输层，网络层，数据链路层，物理层。

## 物理层

### 信道

+ 关于信道的几个概念
  + 单工通信，只能有一个方向发送信息，有限广播以及电视广播 。只需要一条信道
  + 半双工通信，可以由两个方向发送信息，但是两个方向不能同时发送信息。需要两条信道
  + 全双工通信，可以由两个方向发送信息，并且两个方向可以同时发送信息。需要两条信道
+ 传输方式： 串行传输和并行传输
+ 码元是一个固定长度的信号波形
+ 频率过高可能会导致失真现象，原因就是码间串扰，出现这种现象的原因是由于频率过高，导致接收端无法分辨出不同的波形之间的差异。
+ 奈氏准则：数据传输率v=2Wlog2V，W是信号的频率，V是一个码元所携带的比特数
+ 香农定理
  + 信噪比=信号的平均功率/噪声的平均功率。S/N，单位是分贝。
  + 信噪比=10log10(S/N)(dB),根据这个公式，我们可以求出S/N
  + 信道的极限传输速率C=Wlog2(1+S/N)
+ 基带信号：直接传输了我们需要传输的信号
+ 宽带信号：将我们需要传输的信号先进行载波调制，然后就可以放到特定的频段上面进行传输。

### 信道复用技术

+ 最基本的复用技术
  + 频分服用，是指用于在通信过程中始终占用这个频段。
  + 时分复用，将时间划分为一段段登长的时分复用帧，每一个时分复用的用户所占的时间间隙是周期性的。

+ 频分复用
+ 波分复用，利用光纤技术是得数据的传输速率空前提高。
+ 码分复用，码分复用技术各用户使用经过特殊挑选的不同码型，因此各用户直接不会造成干扰。

## 数据链路层

### 使用的通信方式

+ 点对点通信，使用一对一进行通信。
+ 广播通信，使用一对多的广播通信方式，过程比较复杂。

###  点对点通信

+ 封装成帧,在一段数据的前后分别添加首部和尾部，这样就构成了一个帧。

  + 帧是数据链路层的一个数据传送单元，一个帧的帧长等于帧的数据部分长度加上帧的首部和尾部。

  + 帧定界符规定了帧的开始位置和结束位置，在数据进行传输的时候，可以根据首部和尾部位置判断数据是否丢失。

+ 透明传输，当我们传输的是文本的时候，可以放心的进行传输，不会造成误会，不管我们输入的是什么字符，都可以放到帧里面进行传输，这样的传输就是透明传输。

  + 但是，假如我们遇到的是非文本文件的时候，就可能会存在与帧定界相冲突的字符，这个时候就需要我们进行字符填充，这个填充就相当与我们的转义字符，这样就可以避免冲突了。在接收端的时候去掉相应的字节。
  + 解决的方法：字节填充法，字符填充法和零比特填充法。

+ 差错检测，在数据进行传输的时候，数据可能造成差错。所以需要我们对传输的数据进行检查或者进行纠正错误。

  + 奇偶校验码
  + 循环冗余码
  + 海明码（发现双比特错误，纠正单比特错误)

### 使用广播信道的数据链路层

+ 广播信道采用的是共享信道的方法进行数据的传输。在技术上分为静态划分信道和动态媒体接入控制。
  + 静态接入：将某条信道单独分配给某一个用户使用。
  + 动态媒体接入控制：多点接入，分为随机接入和受控接入。
    + 随机接入
    + 受控接入。令牌，探询
+ 以太网是一种基带总线局域网。
+ 适配器，硬件地址放到ROM里面，IP地址放到存储器里面。
+ CSA/CD协议
  + 这个协议是用来进行数据的发送，这是不可靠的交付。
  + 多点接入，载波监听，碰撞检测。
+ MAC地址作为物理地址，是一台计算机的唯一标识。相当与我们每个人的身份证。

### 扩展以太网

+ 首先，这依然是一个网络。
+ 在物理地址上面拓展以太网。使用多个集线器进行拓展。
+ 在数据链路层扩展以太网。使用网桥，通过建立地址表进行查找。后面通常采用的是交换机。以太网交换机上面有很多个接口，相互通信的主机都是独占传输媒体，无碰撞地传输数据。
+ 以太网交换机具有自学功能。

## 网络层

+ 本章最主要的一个协议是IP协议
+ 网络层提供的数据不是可靠的，这是一种不可靠的传输。

#### 网际协议IP

+ 包括三种协议，地址解析协议，网际控制报文协议，网际管理协议。

+ 这一层的主要作用是利用网际协议ip将许多计算机网络互联起来。

+ 将网络连接起来需要一些中间的设备，主要是转发器，网桥和路由器和网关。

  + 网桥：物理层使用的中间设备
  + 网桥：数据链路层使用的中间设备
  + 路由器：网络层使用的中间设备
  + 网关：网络层以上使用的中间设备

+ 互联网直接的网络使用异构组成的

+ 分类的IP地址

  + 根据ip地址的分类，可以将ip地址分为A类，B类，C类，D类和E类。
  + 对于每个地址，一共有四个字节组成

  | 地址类型 | 二进制区分 | 网络号   | 主机号   |
  | -------- | ---------- | -------- | -------- |
  | A类      | 0开头      | 一个字节 | 三个字节 |
  | B类      | 10开头     | 两个字节 | 两个字节 |
  | C类      | 110开头    | 三个字节 | 一个字节 |
  | D类      | 1110开头   | 多播地址 |          |
  | E类      | 1111 开头  | 待分配   |          |

+ 在平常生活中，我们一般使用的是点分十进制法进行表示。

+ 我们重点介绍的是ABC三类地址
  + A类地址：这类地址的网络号占用一个字节，最前面以0开头，所以一共有7位可以被使用，首先，全0是一个保留地址，表示这个网络本身。另外，01111111保留作为本地软件环回测试用来本主机和进程之间的通信使用。整个IP地址的空间共有2^32个地址，但是A类地址减去最开始的那个0之后就还有2^31种地址，所以A类地址占整个IP地址的50%。
  + B类地址：这类地址最前面的网络号有固定是0和1，这样的话我们还有30位可以进行划分。占用整个地址空间的25%
  + C类地址：这类地址最前面固定是110，我们还有21位网络号可以进行划分，占用整个地址的12.5%
+ 我们可以发现，在同一个网段的各个主机之间的ip的网络号必须是一样的。
+ IP地址是一台计算机的逻辑地址，用于网络层及之上的;物理地址是在物理层和数据链路层使用的。

#### 内部网关协议RIP

+ 从路由器到直接来连接的网络的距离定义为1.
+ RIP协议的距离为跳数。最多只能包包含15个路由器，所以这是一种小型网络协议。
+ RIP协议开销较小，传输快。
+ RIP金和相邻路由器交换信息，路由器交换信息是和当前自己的路由表上的路由交换信息，同时按照固定的时间间隔和交换路由信息学。
+ 好消息传播快，坏消息传播慢。

#### OSPF协议（开放最短路优先)

+ 向本自治系统的所有路由器发送信息。这也叫做泛洪法。
+ 只有当链路状态发生改变时，路由器才向所有的路由器用泛洪法。

#### 外部网关协议BGP

#### IPV6

+ IPV6将首部长度变成固定的40字节。称为基本首部。
+ 取消了首部的检验字段。
+ IPV6数据包的目的地址可以说单播，多播和任播三种。
+ ipv6和ipv4的比较
  + 取消了首部长度字段
  + 取消了服务类型字段
  + 取消了总长度字段
  + 取消了标识，标志和片偏移字段
  + 把TTL字段改成条数限制字段
  + 取消了协议字段
  + 取消了检验和字段
  + 取消了选项字段
+ IPV6向IPV4的过渡
  + 使用双协议栈，双协议栈是指在协议传输到某一个字段的时候进行协议的转换，但是会造成部分数据的缺失。
  + 使用隧道协议，该协议是在原数据包的基础上套另一个协议，然后通过该种协议进行数据的传输。

#### 网际协议IP

+ 第4个版本IPv4和第6个版本IPv6
+ 与IP协议配套的协议：
  + 地址解析协议(ARP);
  + 网际控制报文协议(ICMP);
  + 网际组管理协议(IGMP)
+ IP地址及其表示方法
  + IP地址一般由两个字段组成：IP地址=网络号+主机号
    + 网络号，表示的是主机或路由器所连接的网络。网络号是唯一的。
    + 主机号，主机号标志着主机或者路由器。
  + IP地址分为A，B，C，D，E五类地址。其中A，B，C是单播地址。
  + 总长一共4个字节，其中A，B，C的网络号分别占1，2，3个字节，主机号分别占3,2,1个字节。
  + A类地址的网络号只有一个字节，其中的7位可以使用，第一位默认为0.网络号全为0的地址是一个保留地址，表示的是本网络，全1的是作为本地软件测试的回环地址，用于本主机的进程之间的通信。整个A类地址的空间占IP地址的50%。
  + B类地址的网络号占两个字节，其中前两位已经固定下来，为1,0。整个B类地址的空间占IP地址的25%。
  + C类地址的网络号占三个字节，其中前三位确定下来了，分别为1 1 0.还有21位可以进行分配。整个C类地址占IP地址空间为12.5%
  + IP地址是指网络应用层以上使用的地址，而物理地址是在运输层和数据链路层使用的地址。
+ 地址解析协议ARP
  + 作用是从网络层使用的IP协议，解析出在数据链路层使用的硬件地址。通过在主机ARP高速缓存中存放一个从IP协议到硬件地址的映射表，并且这个映射表还经常动态更新。
  + ARP把已经得到的地址映射放到高速缓存里面，这样就是得主机下次再和具有相同的目的地址的主机通行的时候，可以直接从高速缓存里面中找到所需要的硬件地址而不必再以广播的方式发送ARP请求分组。
  + 注意要在同一个局域网下面。
+ IP数据包的格式
  + 首部固定部分中的各字段。
    + 版本，首部长度，区分服务，总长度，标识，标志，片偏移，生存时间，协议，首部检验和，源地址，目的地址。



#### 划分子网和构造超网

+ 划分子网
  + IP地址的空间利用率有时很低，而且二级地址不太灵活，所以，可以对二级IP进行划分，变成三级IP。这种方法叫做划分子网。
  + 划分子网使得二级IP变成三级IP地址。IP地址=网络号+子网号+主机号
  + 路由器收到iP数据包之后，根据目的网络号和子网号找到目的子网，把IP数据报交付给目的主机。
+ 子网掩码
  + 子网掩码是为了在IP数据包的首部看书援助基或者目的主机所连接的网络是否进行了子网的划分。
  + 划分子网增加了灵活性，但是却减少了能够连接在网络上的主机总数。
+ 使用子网时的分组转发，子网划分之后，路由表里面必须要包含目的网络地址，子网掩码和下一跳地址。
+ 无分类编址CIDR(构造超网)
  + 网络前缀
    + CIDR消除了传统的A类，B类和C类地址以及划分子网的概念，更加有效地分配了IPv4的地址。回到了二级地址，也就是IP地址=网络前缀+主机号。
    + 在IP地址后面加上/，表示的是网络前缀所占的位数。
    + CIDR把网络前缀相同的连续IP组成一个CIDR地址块。
    + 斜线标记法中，后面的数字表示的是地址掩码中1的个数。
  + 最长前缀匹配

#### 网际控制报文协议ICMP

+ 有效地转发IP数据报和提高交付成功的机会。
+ ICMP差错报文和ICMP询问报文
  + 差错报文：重点不可达，时间超时，参数问题，改变路由（重定向)，就这四种报文。
  + 询问报文：回送请求和回答，时间戳请求和回答。

## 运输层

#### 概述

+ 运输层是端到端的通信，这里的端是程序在运行的时候暴露的端口。
+ 传输层提供了TCP和UDP两种传输协议
  + TCP是面向连接的，可靠的传输协议，将报文分为多个字段进行传输。有流量控制，无丢失，无重复，按序交付。
  + UDP协议是无连接的，不可靠的协议。无流量控制，有丢失，有重复，可能存在失序的情况。

#### 运输层的端口

+ 端口号是相对本地而言的，端口是为了标记计算机进程，端口只是对本地有意义。
+ 默认的端口是80端口
+ 发送方让应用层的各种引用进程都能将其数据通过端口向下交付给运输层。
+ 接收方那该让运输层知道应当将其报文段中的数据向上通过端口交付给引用层相应的进程。
+ 端口的范围一般为0-65535,其中熟知的端口号一般为0-1023,登记的端口号为:1024-49151,客户端口号或者短暂端口号为:49151-65535

#### UDP(用户数据报)协议

+ 由数据字段和首部字段组成
  + 首部字段为源端口，目的端口，长度和检验和。只占8个字节，每个数字都是由16进制进行表示的;
  + 

#### 传输控制协议TCP

+ 特点
  + TCP的主要特点是面向连接的运输层协议。
  + 每个TCP连接只能有两个端点，是点对点连接。
  + TCP提供可靠交付，无差错，不丢失，不重复。
  + TCP提供全双工通信，通信双方可以同时发送数据和接收数据。
  + 面向字节流，流是进程流向进程的字节序列。

#### TCP报文首部格式

+ TCP分为首部和数据两部分。TCP的功能体现在它的首部字段。
  + 源端口和目的端口，各占两个字节。
  + 序号，占四个字节。TCP中的每个字节都是按照字节进行编号的。最多是4G
  + 确认号，占用四个字节。期望收到对方下一个报文段的第一个数据字节的序号
  + 数据偏移，占四位。
  + 保留，为以后保留空间。
  + 紧急URG，发送应用告诉发送方的TCP有紧急的数据要传输。然后将这个数据放到数据的最前面，优先进行传输。
  + 确认ACK，ACK=1表示字段有效，否则无效。
  + 推送PUSH，当两个进程进行交互通信的时候，一端的应用进程希望在键入一个命令后立即能够收到对方的相应。也就是立马向上交付，交给上层应用。
  + 复位RST，RST=1,表示TCP连接出现严重的错误，需要进行复位。
  + 同步SYN，在连接建立的时候同步序号。
  + 终止FIN，释放一个连接。
  + 窗口，占两个字节。窗口值作为接收方让发送方设置其发送窗口的依据。可以用于流量的控制。
  + 检验和，占2字节，检验和字段检验的范围包括首部和数据这两部分。
  + 紧急指针，占两字节，当URG=1的时候，我们需要设置这个字段，指出了紧急数据的末尾在报文段的位置。
  + 选项
    + 最大报文长度MSS，主要是选取合适的传输数据的长度，过长或者过短都可能会造成多余的开销。TCP和IP的首部都是20个字节，如果不设置，那么就默认为556个字节。数据在TCP进行包装之后，传输到IP层的话还要加上IP数据报的首部20个字节。过短的话利用率较低，过长的话切割报文的开销增加。
    + 选择确认，明确告诉一端哪些数据未收到，可以减少接收到的数据的重复传输。

+ TCP的超时重传的选择
  + 两个时间之差就是报文段的往返时间RTT。TCP保留了RTT的一个加权平均往返时间RTT。
  + 超时重传时间RTO，一般要大于RTT。

### 应用层

+ DNS(域名系统)
  + dns通过解析域名得到相关的ip地址，dns使得大多数的域名可以在本地得到解析。dns存储了主机名和ip地址的对应。通过dns可以查询到某一个域名对应的ip，某一个ip对应的主机名。

+ 代理服务器
  + 代理服务器就相当于一个中转站，代理服务器将一些请求和相关的相应存储到本地磁盘里面，当接受到新的请求的时候，代理服务器先在本地进行查找，如果本地已经有了相关的响应，那么就直接返回，而不用通过url的地址去通过互联网访问相关的资源。从而提高通信的效率和节约流量。
+ HTTP的报文结构
  + 分为请求报文和响应报文
  + 开始行，首部行，实体主体和状态码
+ cookie
  + cookie是由服务器的主机名和识别码组成。
  + 服务其上面可以通过cookie存储用户的信息，但是这个信息不是用户的真实信息，存储的是用户的行为，存储了用户什么时候访问了哪个url，可以用于分析用户的行为。
  + 当用户访问浏览器的时候，服务器就会为该用户产生一个识别码，在之后的访问的，浏览器就会在cookie文件里面找到该用户的cookie，并且放到HTTP请求报文里面。网站服务器如果获取到用户的cookie文件，可以分析用户的行为，然后给用户推荐符合用户的需求的相关服务。

